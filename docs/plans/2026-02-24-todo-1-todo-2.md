# TODO-1 & TODO-2: spa-guard README Files and External Script Mode

## Overview

Two tasks combined into one plan:

1. (TODO-1) Create minimal README.md for all 7 spa-guard packages and update root README with links
2. (TODO-2) Add external script mode to vite plugin and programmatic builder API to node package
3. Delete TODO-1.md and TODO-2.md after completion

## Context

- Files involved: 7 spa-guard package directories, root README.md, spa-guard/node/src/, spa-guard/vite/src/
- Related patterns: existing package.json exports, test files for usage examples
- Dependencies: html-minifier-terser (already in vite package), parse5 (already in node package)

## Development Approach

- **Testing approach**: Regular (code first, then tests)
- Complete each task fully before moving to the next
- README tasks first (simpler, no code changes), then builder API, then vite external mode
- **CRITICAL: every task MUST include new/updated tests**
- **CRITICAL: all tests must pass before starting next task**

## Implementation Steps

### Task 1: Create README.md for @ovineko/spa-guard (Core)

**Files:**

- Create: `spa-guard/spa-guard/README.md`

- [x] Read package.json, src/common/index.ts, src/runtime/index.ts for exports
- [x] Extract simplest example from recommendedSetup.test.ts
- [x] Create minimal README: description, install, usage example (recommendedSetup), API exports list, related packages, license
- [x] Keep under 150 lines, one example only
- [x] Verify badges use correct package name @ovineko/spa-guard

### Task 2: Create README.md for @ovineko/spa-guard-react

**Files:**

- Create: `spa-guard/react/README.md`

- [x] Read package.json, src/react/index.tsx for exports
- [x] Extract lazyWithRetry example from test
- [x] Create minimal README: description, install (with react peer dep), usage example, API exports, related packages, license
- [x] Keep under 150 lines

### Task 3: Create README.md for @ovineko/spa-guard-react-router

**Files:**

- Create: `spa-guard/react-router/README.md`

- [x] Read package.json, src/index.tsx for exports
- [x] Extract ErrorBoundaryReactRouter example from test
- [x] Create minimal README: description, install (with react, react-router peer deps), usage example, related packages, license
- [x] Keep under 150 lines

### Task 4: Create README.md for @ovineko/spa-guard-vite

**Files:**

- Create: `spa-guard/vite/README.md`

- [x] Read package.json, src/index.ts for exports and options
- [x] Extract plugin config example from test
- [x] Create minimal README: description, install (with vite peer dep), usage example, options reference, related packages, license
- [x] Keep under 150 lines

### Task 5: Create README.md for @ovineko/spa-guard-node

**Files:**

- Create: `spa-guard/node/README.md`

- [x] Read package.json, src/index.ts for exports
- [x] Extract createHtmlCache example from test
- [x] Create minimal README: description, install (with parse5 peer dep), usage example, API exports, related packages, license
- [x] Keep under 150 lines

### Task 6: Create README.md for @ovineko/spa-guard-fastify

**Files:**

- Create: `spa-guard/fastify/README.md`

- [x] Read package.json, src/index.ts for exports
- [x] Extract fastifySPAGuard plugin registration example from test
- [x] Create minimal README: description, install (with fastify, fastify-plugin, spa-guard-node peer deps), usage example, related packages, license
- [x] Keep under 150 lines

### Task 7: Create README.md for @ovineko/spa-guard-eslint

**Files:**

- Create: `spa-guard/eslint/README.md`

- [x] Read package.json, src/index.ts for exports
- [x] Extract recommended config example from test
- [x] Create minimal README: description, install (with eslint peer dep), usage example showing both rules, related packages, license
- [x] Keep under 150 lines

### Task 8: Update root README.md with package README links

**Files:**

- Modify: `README.md`

- [x] Make package names in the table link to their README.md files (e.g., `[@ovineko/spa-guard](./spa-guard/spa-guard/README.md)`)
- [x] Verify all 7 links are correct

### Task 9: Programmatic Builder API in spa-guard-node

**Files:**

- Create: `spa-guard/node/src/builder.ts`
- Modify: `spa-guard/node/src/index.ts` (add exports)
- Modify: `spa-guard/node/package.json` (add exports entry, files, build scripts)

- [ ] Create builder.ts with BuildScriptOptions, BuildScriptResult interfaces
- [ ] Implement buildSpaGuardScript(): reads pre-built inline scripts from dist-inline/, processes options, generates content hash, builds structured tag objects, generates HTML string
- [ ] Implement buildExternalScript(): writes script file to outDir, returns public URL and tags
- [ ] Add html-minifier-terser dependency to node package
- [ ] Add copy:bundles script to copy dist-inline/ and dist-inline-trace/ from vite package
- [ ] Add dist-inline, dist-inline-trace to files array in package.json
- [ ] Export buildSpaGuardScript, buildExternalScript from index.ts
- [ ] Add `./builder` export path in package.json if needed
- [ ] Write tests for buildSpaGuardScript (verify output structure, hash consistency, options processing)
- [ ] Write tests for buildExternalScript (verify file creation, public URL generation)
- [ ] Run pnpm test in spa-guard/node - must pass

### Task 10: External Script Mode in spa-guard-vite

**Files:**

- Modify: `spa-guard/vite/src/index.ts` (add mode option, external mode logic)
- Modify: `spa-guard/vite/package.json` (add @ovineko/spa-guard-node dependency)

- [ ] Add mode, externalScriptDir, publicPath to VitePluginOptions interface
- [ ] Add @ovineko/spa-guard-node as workspace dependency
- [ ] For mode: 'inline' (default) - keep existing behavior unchanged
- [ ] For mode: 'external' - use writeBundle hook to call buildExternalScript from node package
- [ ] Generate `<script src="...">` tag instead of inline script content for external mode
- [ ] Write tests for external mode (verify file generation, correct script tag, hash in filename)
- [ ] Verify existing inline mode tests still pass
- [ ] Run pnpm test in spa-guard/vite - must pass

### Task 11: Verify acceptance criteria

- [ ] All 7 README.md files exist and are under 150 lines
- [ ] Root README links point to correct README.md files
- [ ] Code examples in READMEs are syntactically correct
- [ ] Peer dependencies in READMEs match package.json
- [ ] Builder API works standalone (buildSpaGuardScript returns correct structure)
- [ ] External mode generates file with content hash
- [ ] Inline mode (default) is unchanged
- [ ] run full test suite: pnpm test
- [ ] run linter: pnpm lint
- [ ] run typecheck: pnpm typecheck
- [ ] run build: pnpm build

### Task 12: Update documentation and cleanup

- [ ] Update spa-guard/node/README.md to mention builder API
- [ ] Update spa-guard/vite/README.md to mention external mode option
- [ ] Delete TODO-1.md and TODO-2.md
- [ ] Move this plan to `docs/plans/completed/`
